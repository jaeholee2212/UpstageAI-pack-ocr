#!/bin/bash

command=${1}
shift

ensure_network() {
  local name=$1
  shift
  local filtered=$(docker network ls --filter name=$name --format {{.Name}})
  if [[ $name = $filtered ]]; then
    return 0
  fi
  echo "network: created - $(docker network create $@ $name)"
}

ensure_network 'infra-public' --driver=overlay --attachable
ensure_network 'infra-private' --driver=overlay --attachable --internal

case ${command} in
  node)
    nodeid=$(docker info -f '{{.Swarm.NodeID}}')
    subcmd=$1
    shift
    case ${subcmd} in
      id)
        echo ${nodeid}
        ;;
    esac
    ;;
  *)
    echo "info node id -- node id"
    ;;
esac


